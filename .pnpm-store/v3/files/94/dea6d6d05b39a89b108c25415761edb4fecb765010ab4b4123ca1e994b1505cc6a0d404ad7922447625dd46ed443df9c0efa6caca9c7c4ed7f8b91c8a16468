const a3_0x22ca=['...','assign','from','Stack\x20Trace:','throw','api','../../../utilities/nx-imports','application/octet-stream','startRun','string','headers','RUNNER_FAILURE_PERF_ENTRY','__esModule','/nx-cloud/runs/end','stringify','Run\x20completion\x20responded\x20with\x20`undefined`.','Invalid\x20end\x20run\x20response:\x20','next','gzip','machineInfo','../../../utilities/environment','Invalid\x20Nx\x20Cloud\x20response:\x20','then','extractErrorMessage','package.json','zlib','stack','toString','response','../../../utilities/axios','parse','apiError','VERBOSE_LOGGING','defineProperty','slice','endRun','value','getRunGroup','CloudRunApi','note','createApiAxiosInstance','RunEnd.\x20Completed\x20tasks','Invalid\x20end\x20run\x20response','terminalOutput','apiAxiosInstance','recordMetric','data','Run\x20Details:','success','mapRespToPerfEntry','runUrl','axiosMultipleTries','promisify','devDependencies','unknown','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','createMetricRecorder','post','nxCloudVersion','createReqBody','map','messages','defaults','error','axiosException','__awaiter','urls','runContext','message','done'];(function(_0x223aa2,_0x22ca7a){const _0x1f8ba7=function(_0x143f8d){while(--_0x143f8d){_0x223aa2['push'](_0x223aa2['shift']());}};_0x1f8ba7(++_0x22ca7a);}(a3_0x22ca,0xf3));const a3_0x1f8b=function(_0x223aa2,_0x22ca7a){_0x223aa2=_0x223aa2-0x0;let _0x1f8ba7=a3_0x22ca[_0x223aa2];return _0x1f8ba7;};'use strict';var __awaiter=this&&this[a3_0x1f8b('0x20')]||function(_0x22c94f,_0x4dc877,_0x41972e,_0x31f693){function _0x46b06a(_0x178b64){return _0x178b64 instanceof _0x41972e?_0x178b64:new _0x41972e(function(_0x51867c){_0x51867c(_0x178b64);});}return new(_0x41972e||(_0x41972e=Promise))(function(_0x4176f8,_0x1eb8bd){function _0x5d4c49(_0x3cab75){try{_0x1488f2(_0x31f693['next'](_0x3cab75));}catch(_0x49fcdc){_0x1eb8bd(_0x49fcdc);}}function _0x5cb9f4(_0x4f861b){try{_0x1488f2(_0x31f693[a3_0x1f8b('0x29')](_0x4f861b));}catch(_0x15717f){_0x1eb8bd(_0x15717f);}}function _0x1488f2(_0x31af08){_0x31af08[a3_0x1f8b('0x24')]?_0x4176f8(_0x31af08['value']):_0x46b06a(_0x31af08[a3_0x1f8b('0x3')])[a3_0x1f8b('0x3b')](_0x5d4c49,_0x5cb9f4);}_0x1488f2((_0x31f693=_0x31f693['apply'](_0x22c94f,_0x4dc877||[]))[a3_0x1f8b('0x36')]());});};Object[a3_0x1f8b('0x0')](exports,a3_0x1f8b('0x31'),{'value':!![]});exports['CloudRunApi']=void 0x0;const axios_1=require(a3_0x1f8b('0x42'));const environment_1=require(a3_0x1f8b('0x39'));const fs_1=require('fs');const zlib_1=require(a3_0x1f8b('0x3e'));const util_1=require('util');const metric_logger_1=require('../../../utilities/metric-logger');const {output}=require(a3_0x1f8b('0x2b'));class CloudRunApi{constructor(_0x5315db,_0x1b32d4,_0x5cf3ed,_0x5bf311){this[a3_0x1f8b('0x1c')]=_0x5315db;this[a3_0x1f8b('0x22')]=_0x1b32d4;this['machineInfo']=_0x5bf311;this[a3_0x1f8b('0xb')]=(0x0,axios_1[a3_0x1f8b('0x7')])(_0x5cf3ed);}[a3_0x1f8b('0x2d')](_0x25d26f,_0x64afe4){var _0x48066c;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4f96cf=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x1f8b('0x2d'));try{const _0x2ff0cd={'meta':{'nxCloudVersion':this[a3_0x1f8b('0x19')]()},'branch':(0x0,environment_1['getBranch'])(),'runGroup':(0x0,environment_1[a3_0x1f8b('0x4')])(),'distributedExecutionId':_0x25d26f,'hashes':_0x64afe4};if(environment_1['VERBOSE_LOGGING']){output[a3_0x1f8b('0x6')]({'title':'RunStart','bodyLines':['\x0a'+JSON[a3_0x1f8b('0x33')](_0x2ff0cd,null,0x2)]});}const _0x523374=yield(0x0,axios_1[a3_0x1f8b('0x12')])(()=>this[a3_0x1f8b('0xb')]['post']('/nx-cloud/runs/start',_0x2ff0cd));_0x4f96cf['recordMetric']((0x0,metric_logger_1[a3_0x1f8b('0x10')])(_0x523374));if(_0x523374['data']&&_0x523374[a3_0x1f8b('0xd')]['message']){this[a3_0x1f8b('0x1c')][a3_0x1f8b('0x23')]=_0x523374[a3_0x1f8b('0xd')][a3_0x1f8b('0x23')];}if(!_0x523374['data']||!_0x523374[a3_0x1f8b('0xd')][a3_0x1f8b('0x21')]){this[a3_0x1f8b('0x1c')][a3_0x1f8b('0x44')]=a3_0x1f8b('0x3a')+JSON[a3_0x1f8b('0x33')](_0x523374[a3_0x1f8b('0xd')]);return{};}return _0x523374[a3_0x1f8b('0xd')][a3_0x1f8b('0x21')];}catch(_0x40b80c){_0x4f96cf[a3_0x1f8b('0xc')](((_0x48066c=_0x40b80c===null||_0x40b80c===void 0x0?void 0x0:_0x40b80c[a3_0x1f8b('0x1f')])===null||_0x48066c===void 0x0?void 0x0:_0x48066c[a3_0x1f8b('0x41')])?(0x0,metric_logger_1[a3_0x1f8b('0x10')])(_0x40b80c[a3_0x1f8b('0x1f')]['response']):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);this['messages'][a3_0x1f8b('0x44')]=this['messages'][a3_0x1f8b('0x3c')](_0x40b80c,'api');return{};}});}[a3_0x1f8b('0x1a')](_0x35040f,_0x5625da){const _0x51dfa2={'meta':{'nxCloudVersion':this[a3_0x1f8b('0x19')]()},'tasks':_0x5625da,'run':_0x35040f,'machineInfo':this[a3_0x1f8b('0x38')]};return JSON['stringify'](_0x51dfa2);}[a3_0x1f8b('0x2')](_0x27ce54,_0x18772e){var _0xd0937e,_0x1f662d;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x1f8b('0x1c')][a3_0x1f8b('0x44')])return![];let _0x529eeb=this['createReqBody'](_0x27ce54,_0x18772e);if(_0x529eeb['length']>0x14*0x3e8*0x3e8){_0x529eeb=this['createReqBody'](_0x27ce54,_0x18772e[a3_0x1f8b('0x1b')](_0x7ad001=>Object[a3_0x1f8b('0x26')](Object[a3_0x1f8b('0x26')]({},_0x7ad001),{'hashDetails':undefined})));}const _0x1ec9c0=Buffer[a3_0x1f8b('0x27')](_0x529eeb);const _0x9ec2e4=yield(0x0,util_1[a3_0x1f8b('0x13')])(zlib_1[a3_0x1f8b('0x37')])(_0x1ec9c0);const _0x63d4a0=(0x0,metric_logger_1[a3_0x1f8b('0x17')])('endRun');try{if(environment_1[a3_0x1f8b('0x45')]){const _0x4a70b2=_0x18772e[a3_0x1f8b('0x1b')](_0x4314e7=>{return Object[a3_0x1f8b('0x26')](Object[a3_0x1f8b('0x26')]({},_0x4314e7),{'terminalOutput':_0x4314e7[a3_0x1f8b('0xa')]?_0x4314e7[a3_0x1f8b('0xa')][a3_0x1f8b('0x1')](0x0,0x14)+a3_0x1f8b('0x25'):undefined});});output[a3_0x1f8b('0x6')]({'title':a3_0x1f8b('0x8'),'bodyLines':['\x0a'+JSON['stringify'](_0x4a70b2,null,0x2)]});}const _0x546be0=yield(0x0,axios_1[a3_0x1f8b('0x12')])(()=>this['apiAxiosInstance'][a3_0x1f8b('0x18')](a3_0x1f8b('0x32'),_0x9ec2e4,{'headers':Object['assign'](Object['assign']({},this[a3_0x1f8b('0xb')][a3_0x1f8b('0x1d')][a3_0x1f8b('0x2f')]),{'Content-Encoding':a3_0x1f8b('0x37'),'Content-Type':a3_0x1f8b('0x2c')})}));if(_0x546be0){_0x63d4a0[a3_0x1f8b('0xc')]((0x0,metric_logger_1[a3_0x1f8b('0x10')])(_0x546be0));if(_0x546be0[a3_0x1f8b('0xd')]&&_0x546be0[a3_0x1f8b('0xd')][a3_0x1f8b('0x11')]&&_0x546be0[a3_0x1f8b('0xd')]['status']===a3_0x1f8b('0xf')){this[a3_0x1f8b('0x22')][a3_0x1f8b('0x11')]=_0x546be0[a3_0x1f8b('0xd')][a3_0x1f8b('0x11')];return!![];}if(_0x546be0[a3_0x1f8b('0xd')]&&_0x546be0[a3_0x1f8b('0xd')]['status']){this[a3_0x1f8b('0x1c')][a3_0x1f8b('0x44')]=a3_0x1f8b('0x35')+JSON[a3_0x1f8b('0x33')](_0x546be0[a3_0x1f8b('0xd')][a3_0x1f8b('0x23')]);}else if(_0x546be0[a3_0x1f8b('0xd')]&&typeof _0x546be0[a3_0x1f8b('0xd')]===a3_0x1f8b('0x2e')){if(_0x546be0['data']!==a3_0x1f8b('0xf')){this['messages'][a3_0x1f8b('0x44')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x1f8b('0x33')](_0x546be0[a3_0x1f8b('0xd')]);}}else{this[a3_0x1f8b('0x1c')][a3_0x1f8b('0x44')]=a3_0x1f8b('0x35')+JSON[a3_0x1f8b('0x33')](_0x546be0[a3_0x1f8b('0xd')]);}if(environment_1[a3_0x1f8b('0x45')]){output[a3_0x1f8b('0x6')]({'title':a3_0x1f8b('0x9'),'bodyLines':[JSON['stringify'](_0x546be0[a3_0x1f8b('0xd')],null,0x2)]});}}else{output[a3_0x1f8b('0x1e')]({'title':a3_0x1f8b('0x16'),'bodyLines':[a3_0x1f8b('0x34'),a3_0x1f8b('0xe'),JSON['stringify'](_0x27ce54,null,0x2),a3_0x1f8b('0x28'),JSON[a3_0x1f8b('0x33')](new Error()[a3_0x1f8b('0x3f')],null,0x2)]});}return![];}catch(_0x368e7a){_0x63d4a0[a3_0x1f8b('0xc')](((_0xd0937e=_0x368e7a===null||_0x368e7a===void 0x0?void 0x0:_0x368e7a[a3_0x1f8b('0x1f')])===null||_0xd0937e===void 0x0?void 0x0:_0xd0937e[a3_0x1f8b('0x41')])?(0x0,metric_logger_1[a3_0x1f8b('0x10')])(_0x368e7a[a3_0x1f8b('0x1f')][a3_0x1f8b('0x41')]):metric_logger_1[a3_0x1f8b('0x30')]);const _0x421d91=(_0x1f662d=_0x368e7a[a3_0x1f8b('0x1f')])!==null&&_0x1f662d!==void 0x0?_0x1f662d:_0x368e7a;this[a3_0x1f8b('0x1c')]['apiError']=this[a3_0x1f8b('0x1c')][a3_0x1f8b('0x3c')](_0x421d91,a3_0x1f8b('0x2a'));return![];}});}['nxCloudVersion'](){try{const _0x50be7c=JSON[a3_0x1f8b('0x43')]((0x0,fs_1['readFileSync'])(a3_0x1f8b('0x3d'))[a3_0x1f8b('0x40')]());return _0x50be7c[a3_0x1f8b('0x14')]['@nrwl/nx-cloud'];}catch(_0x2229fa){return a3_0x1f8b('0x15');}}}exports[a3_0x1f8b('0x5')]=CloudRunApi;