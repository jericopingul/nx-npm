const a5_0x3321=['projects','Duplicate\x20Agent\x20ID\x20Detected','error','throw','exit','NX_AGENT_NAME','__awaiter','Agent\x20','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.','unlinkSync','random','child_process','mkdirSync','options','defineProperty','Critical\x20Error\x20in\x20Agent:\x20\x22','Waiting...','taskId','params','target','toString','Fetching\x20tasks...','inherit','SIGINT','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.','completed:\x20','./distributed-agent.api','../../../utilities/create-no-new-messages-timeout','Distributed\x20Execution\x20Terminated','push','tasks','../../../utilities/metric-logger','getTime','cacheDirectory','configuration','/tasks-hashes-','submitRunMetrics','getRunGroup','execSync','maxParallel','retryDuring','number\x20of\x20tasks:\x20','writeFileSync','next','warn','map','true','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','CIRCLE_STAGE','We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','note','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','parse','projectName','../../../utilities/waiter','env','done','createNoNewMessagesTimeout','wait','completedTasks','/nx.json','join','startAgent','./node_modules/.cache/nx',').\x20Tasks\x20hashes\x20haven\x27t\x20been\x20recorded.','Other\x20Nx\x20Cloud\x20Agents\x20Detected','../../error/print-run-group-error','Command\x20execution\x20failed\x20(distributed\x20task\x20execution:\x20','includes','VERBOSE_LOGGING','Waiter','reset','floor','\x20--projects=','completedStatusCode','executionId','catch','.lock','../../../utilities/environment','Error:','status','completeRunGroupWithError','/lockfiles','apply','readFileSync','assign','We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','completed','__esModule','length','error:\x20','API\x20Response','tasksRunnerOptions','printRunGroupError','\x20--parallel\x20--max-parallel=','then','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks','maxParallel:\x20','criticalErrorMessage'];(function(_0x10aeaa,_0x332118){const _0x473677=function(_0x349e15){while(--_0x349e15){_0x10aeaa['push'](_0x10aeaa['shift']());}};_0x473677(++_0x332118);}(a5_0x3321,0xaa));const a5_0x4736=function(_0x10aeaa,_0x332118){_0x10aeaa=_0x10aeaa-0x0;let _0x473677=a5_0x3321[_0x10aeaa];return _0x473677;};'use strict';var __awaiter=this&&this[a5_0x4736('0x22')]||function(_0x2c9164,_0x5771e6,_0xf996d4,_0x1fba06){function _0x3aa26b(_0x16139b){return _0x16139b instanceof _0xf996d4?_0x16139b:new _0xf996d4(function(_0x2dcd6b){_0x2dcd6b(_0x16139b);});}return new(_0xf996d4||(_0xf996d4=Promise))(function(_0x3fc637,_0x4c5d2c){function _0x21c530(_0x11be16){try{_0x82d0a2(_0x1fba06[a5_0x4736('0x47')](_0x11be16));}catch(_0x51f888){_0x4c5d2c(_0x51f888);}}function _0x41813b(_0x4ac455){try{_0x82d0a2(_0x1fba06[a5_0x4736('0x1f')](_0x4ac455));}catch(_0x388775){_0x4c5d2c(_0x388775);}}function _0x82d0a2(_0x1e7348){_0x1e7348[a5_0x4736('0x54')]?_0x3fc637(_0x1e7348['value']):_0x3aa26b(_0x1e7348['value'])[a5_0x4736('0x18')](_0x21c530,_0x41813b);}_0x82d0a2((_0x1fba06=_0x1fba06[a5_0x4736('0xc')](_0x2c9164,_0x5771e6||[]))[a5_0x4736('0x47')]());});};Object[a5_0x4736('0x2a')](exports,a5_0x4736('0x11'),{'value':!![]});exports['startAgent']=void 0x0;const child_process_1=require(a5_0x4736('0x27'));const stripJsonComments=require('strip-json-comments');const distributed_agent_api_1=require(a5_0x4736('0x36'));const waiter_1=require(a5_0x4736('0x52'));const environment_1=require(a5_0x4736('0x7'));const print_run_group_error_1=require(a5_0x4736('0x5e'));const create_no_new_messages_timeout_1=require(a5_0x4736('0x37'));const fs_1=require('fs');const metric_logger_1=require(a5_0x4736('0x3b'));const {output,workspaceRoot}=require('../../../utilities/nx-imports');function executeTasks(_0x44f08b,_0x92c848){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x47273e=0x0;let _0x50302a=null;const _0x15c844=(0x0,create_no_new_messages_timeout_1[a5_0x4736('0x55')])();const _0x211d1b=new waiter_1[(a5_0x4736('0x62'))]();let _0x478c38=[];const _0x423732=new Date();let _0xca392f=![];while(!![]){if(environment_1[a5_0x4736('0x61')]){output[a5_0x4736('0x4e')]({'title':a5_0x4736('0x31')});}_0x50302a=yield _0x92c848[a5_0x4736('0x3a')](_0x50302a?_0x50302a['executionId']:null,_0x47273e,_0x478c38);if(environment_1['VERBOSE_LOGGING']){output[a5_0x4736('0x4e')]({'title':a5_0x4736('0x14'),'bodyLines':[a5_0x4736('0x35')+_0x50302a[a5_0x4736('0x10')],'retryDuring:\x20'+_0x50302a[a5_0x4736('0x44')],'executionId:\x20'+_0x50302a[a5_0x4736('0x4')],a5_0x4736('0x45')+_0x50302a[a5_0x4736('0x3a')][a5_0x4736('0x12')],a5_0x4736('0x13')+_0x50302a[a5_0x4736('0x1b')],a5_0x4736('0x1a')+_0x50302a[a5_0x4736('0x43')]]});}if(_0x50302a[a5_0x4736('0x1b')]){output[a5_0x4736('0x1e')]({'title':a5_0x4736('0x38'),'bodyLines':[a5_0x4736('0x8'),_0x50302a[a5_0x4736('0x1b')]]});process[a5_0x4736('0x20')](0x0);}if((_0x50302a===null||_0x50302a===void 0x0?void 0x0:_0x50302a[a5_0x4736('0x44')])&&(_0x50302a===null||_0x50302a===void 0x0?void 0x0:_0x50302a[a5_0x4736('0x44')])!==0x0&&!_0xca392f&&new Date()[a5_0x4736('0x3c')]()-_0x423732[a5_0x4736('0x3c')]()>_0x50302a[a5_0x4736('0x44')]){yield _0x211d1b[a5_0x4736('0x56')]();continue;}if(_0x50302a[a5_0x4736('0x10')])return;_0x15c844(_0x50302a[a5_0x4736('0x3a')][a5_0x4736('0x49')](_0x2a16e9=>_0x2a16e9[a5_0x4736('0x2d')])['join'](''));if(!_0x50302a[a5_0x4736('0x4')]){if(environment_1[a5_0x4736('0x61')]){output[a5_0x4736('0x4e')]({'title':a5_0x4736('0x2c')});}yield _0x211d1b[a5_0x4736('0x56')]();_0x47273e=0x0;_0x478c38=[];continue;}_0x211d1b[a5_0x4736('0x0')]();_0xca392f=!![];const _0xa7753c=invokeTasksUsingRunMany(_0x44f08b,_0x50302a[a5_0x4736('0x4')],_0x50302a['tasks'],_0x50302a[a5_0x4736('0x43')]);_0x47273e=_0xa7753c[a5_0x4736('0x3')];_0x478c38=_0xa7753c[a5_0x4736('0x57')];}});}function readCompletedTasks(_0x36b040,_0x301758){const _0x299163=a5_0x4736('0x5f')+_0x301758+a5_0x4736('0x5c');let _0x1a437;try{const _0x21fbce=_0x36b040[a5_0x4736('0x3d')]||a5_0x4736('0x5b');const _0x1e8697=_0x21fbce+a5_0x4736('0x3f')+_0x301758;_0x1a437=JSON['parse']((0x0,fs_1[a5_0x4736('0xd')])(_0x1e8697)[a5_0x4736('0x30')]());(0x0,fs_1[a5_0x4736('0x25')])(_0x1e8697);}catch(_0x585e83){throw new Error(_0x299163);}if(_0x1a437[a5_0x4736('0x12')]==0x0){throw new Error(_0x299163);}return _0x1a437;}function invokeTasksUsingRunMany(_0x4c3fa7,_0x1b10b2,_0xea45d2,_0x1d35d0){let _0x280016=0x0;const _0x1ed76f=[];for(const _0x1ae264 of groupByTarget(_0xea45d2)){const _0xa3b769=_0x1ae264[a5_0x4736('0x3e')]?'--configuration='+_0x1ae264[a5_0x4736('0x3e')]:'';const _0x43624d=_0x1d35d0>0x1?a5_0x4736('0x17')+_0x1d35d0:'';const _0x2cac62='npx\x20nx\x20run-many\x20--target='+_0x1ae264[a5_0x4736('0x2f')]+'\x20'+_0xa3b769+a5_0x4736('0x2')+_0x1ae264[a5_0x4736('0x1c')][a5_0x4736('0x59')](',')+'\x20'+_0x1ae264[a5_0x4736('0x2e')]+_0x43624d;if(environment_1[a5_0x4736('0x61')]){output[a5_0x4736('0x4e')]({'title':'Executing:\x20\x27'+_0x2cac62+'\x27'});}try{(0x0,child_process_1[a5_0x4736('0x42')])(_0x2cac62,{'stdio':[a5_0x4736('0x32'),a5_0x4736('0x32'),'inherit'],'env':Object[a5_0x4736('0xe')](Object[a5_0x4736('0xe')]({},process[a5_0x4736('0x53')]),{'NX_CACHE_FAILURES':a5_0x4736('0x4a'),'NX_CLOUD_DISTRIBUTED_EXECUTION_ID':_0x1b10b2})});}catch(_0x120998){if(_0x120998[a5_0x4736('0x9')]===environment_1[a5_0x4736('0x4b')]){throw _0x120998;}else{_0x280016=0x1;}}finally{_0x1ed76f[a5_0x4736('0x39')](...readCompletedTasks(_0x4c3fa7,_0x1b10b2));}}return{'completedStatusCode':_0x280016,'completedTasks':_0x1ed76f};}function groupByTarget(_0x3849b3){const _0x210249=[];_0x3849b3['forEach'](_0x58b9fb=>{const _0x297e6a=_0x210249['find'](_0x3a9cf0=>_0x3a9cf0[a5_0x4736('0x2f')]===_0x58b9fb[a5_0x4736('0x2f')]&&_0x3a9cf0[a5_0x4736('0x3e')]===_0x58b9fb['configuration']);if(_0x297e6a){_0x297e6a[a5_0x4736('0x1c')]['push'](_0x58b9fb[a5_0x4736('0x51')]);}else{_0x210249[a5_0x4736('0x39')]({'target':_0x58b9fb[a5_0x4736('0x2f')],'projects':[_0x58b9fb['projectName']],'params':_0x58b9fb['params'],'configuration':_0x58b9fb[a5_0x4736('0x3e')]});}});return _0x210249;}function getAgentName(){if(process[a5_0x4736('0x53')][a5_0x4736('0x21')]!==undefined){return process['env'][a5_0x4736('0x21')];}else if(process[a5_0x4736('0x53')]['CIRCLECI']!==undefined){return process[a5_0x4736('0x53')][a5_0x4736('0x4c')];}else{return a5_0x4736('0x23')+Math[a5_0x4736('0x1')](Math[a5_0x4736('0x26')]()*0x186a0);}}function createAgentLockfile(_0x1dc43a,_0x12948){const _0x2d52fa=_0x1dc43a['cacheDirectory']||a5_0x4736('0x5b');const _0x37922c=_0x2d52fa+a5_0x4736('0xb');const _0x2f9dc4=_0x37922c+'/'+_0x12948+a5_0x4736('0x6');if(!(0x0,fs_1['existsSync'])(_0x37922c)){(0x0,fs_1[a5_0x4736('0x28')])(_0x37922c,{'recursive':!![]});}const _0x44ce80=(0x0,fs_1['readdirSync'])(_0x37922c);if(_0x44ce80[a5_0x4736('0x12')]){if(_0x44ce80[a5_0x4736('0x60')](_0x12948+a5_0x4736('0x6'))){output[a5_0x4736('0x1e')]({'title':a5_0x4736('0x1d'),'bodyLines':[a5_0x4736('0xf'),'',a5_0x4736('0x34')]});process[a5_0x4736('0x20')](0x1);}output[a5_0x4736('0x48')]({'title':a5_0x4736('0x5d'),'bodyLines':[a5_0x4736('0x4d'),'',a5_0x4736('0x24'),a5_0x4736('0x4f')]});}(0x0,fs_1[a5_0x4736('0x46')])(_0x2f9dc4,'');process['on'](a5_0x4736('0x20'),_0x3599ff=>cleanupAgentLockfile(_0x2f9dc4,_0x3599ff));process['on'](a5_0x4736('0x33'),()=>cleanupAgentLockfile(_0x2f9dc4,0x0));}function cleanupAgentLockfile(_0x140e74,_0x3b0804){if((0x0,fs_1['existsSync'])(_0x140e74)){(0x0,fs_1[a5_0x4736('0x25')])(_0x140e74);process[a5_0x4736('0x20')](_0x3b0804);}}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x14775f=(0x0,environment_1[a5_0x4736('0x41')])();if(!_0x14775f){(0x0,print_run_group_error_1[a5_0x4736('0x16')])();return process[a5_0x4736('0x20')](0x1);}output[a5_0x4736('0x4e')]({'title':a5_0x4736('0x19')});const _0x5f239e=JSON[a5_0x4736('0x50')](stripJsonComments((0x0,fs_1[a5_0x4736('0xd')])(workspaceRoot+a5_0x4736('0x58'))[a5_0x4736('0x30')]()))[a5_0x4736('0x15')]['default'][a5_0x4736('0x29')];const _0x5dd8f7=getAgentName();createAgentLockfile(_0x5f239e,_0x5dd8f7);const _0x27f018=new distributed_agent_api_1['DistributedAgentApi'](_0x5f239e,_0x14775f,_0x5dd8f7);return executeTasks(_0x5f239e,_0x27f018)[a5_0x4736('0x18')](_0x464113=>__awaiter(this,void 0x0,void 0x0,function*(){yield(0x0,metric_logger_1[a5_0x4736('0x40')])(_0x5f239e);return _0x464113;}))[a5_0x4736('0x5')](_0x1137ea=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x27f018[a5_0x4736('0xa')](a5_0x4736('0x2b')+_0x1137ea['message']+'\x22');throw _0x1137ea;}));});}exports[a5_0x4736('0x5a')]=startAgent;