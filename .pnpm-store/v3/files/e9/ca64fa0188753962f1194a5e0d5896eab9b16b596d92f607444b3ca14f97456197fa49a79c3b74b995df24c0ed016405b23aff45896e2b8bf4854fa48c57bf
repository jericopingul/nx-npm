const a1_0x2afc=['printCacheHitsMessage','lifeCycle','CloudRunApi','error','env','value','exit','map','toISOString','tasks-hashes-','__awaiter','../../../utilities/metric-logger','../../terminal-output/end-of-run-message','assign','FileStorage','../../terminal-output/message-reporter','throw','./cloud-enabled-life-cycle','OutputObfuscator','requests','EndOfRunMessage','cacheableOperations','complete','skipNxCache','waitForStoreRequestsToComplete','obfuscate','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','getBranch','cloudEnabledTasksRunner','anyErrors','CloudRemoteCache','../../../utilities/nx-imports','all','parseCommand','../../api/error-reporter.api','catch','filter','../../../utilities/environment','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','__esModule','VERBOSE_LOGGING','then','done','encryptionKey','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','MessageReporter','ENCRYPTION_KEY','./cloud-run.api','subscribe','endRun','Executed\x20tasks\x20with\x20hashes:\x20','./cloud-remote-cache','note','getRunGroup','cacheDirectory','printMessages','startRun','next','Agent\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run'];(function(_0x37edbb,_0x2afc1c){const _0x2bdc5b=function(_0xfcea3b){while(--_0xfcea3b){_0x37edbb['push'](_0x37edbb['shift']());}};_0x2bdc5b(++_0x2afc1c);}(a1_0x2afc,0x14f));const a1_0x2bdc=function(_0x37edbb,_0x2afc1c){_0x37edbb=_0x37edbb-0x0;let _0x2bdc5b=a1_0x2afc[_0x37edbb];return _0x2bdc5b;};'use strict';var __awaiter=this&&this[a1_0x2bdc('0x1d')]||function(_0x393b52,_0x2d56d7,_0x3816ba,_0x1220c3){function _0x54b247(_0x7eab7f){return _0x7eab7f instanceof _0x3816ba?_0x7eab7f:new _0x3816ba(function(_0xbab909){_0xbab909(_0x7eab7f);});}return new(_0x3816ba||(_0x3816ba=Promise))(function(_0x48d6e6,_0xb53f75){function _0x2753f7(_0x8047c0){try{_0x84b806(_0x1220c3[a1_0x2bdc('0x11')](_0x8047c0));}catch(_0x281dcb){_0xb53f75(_0x281dcb);}}function _0x394224(_0x5f1319){try{_0x84b806(_0x1220c3[a1_0x2bdc('0x23')](_0x5f1319));}catch(_0x2f7131){_0xb53f75(_0x2f7131);}}function _0x84b806(_0xc8aea5){_0xc8aea5[a1_0x2bdc('0x2')]?_0x48d6e6(_0xc8aea5[a1_0x2bdc('0x18')]):_0x54b247(_0xc8aea5[a1_0x2bdc('0x18')])[a1_0x2bdc('0x1')](_0x2753f7,_0x394224);}_0x84b806((_0x1220c3=_0x1220c3['apply'](_0x393b52,_0x2d56d7||[]))[a1_0x2bdc('0x11')]());});};Object['defineProperty'](exports,a1_0x2bdc('0x3a'),{'value':!![]});exports['cloudEnabledTasksRunner']=void 0x0;const message_reporter_1=require(a1_0x2bdc('0x22'));const end_of_run_message_1=require(a1_0x2bdc('0x1f'));const output_obfuscator_1=require('../../terminal-output/output-obfuscator');const cloud_enabled_life_cycle_1=require(a1_0x2bdc('0x24'));const file_storage_1=require('../../file-storage/file-storage');const e2e_encryption_1=require('../../file-storage/e2e-encryption');const environment_1=require(a1_0x2bdc('0x38'));const cloud_remote_cache_1=require(a1_0x2bdc('0xb'));const cloud_run_api_1=require(a1_0x2bdc('0x7'));const fs_1=require('fs');const path=require('path');const metric_logger_1=require(a1_0x2bdc('0x1e'));const error_reporter_api_1=require(a1_0x2bdc('0x35'));const {tasksRunner,output}=require(a1_0x2bdc('0x32'));function createApi(_0x1eef70,_0x32f271,_0x296b97){const _0x2e4340=(0x0,environment_1['getMachineInfo'])(_0x32f271);return new cloud_run_api_1[(a1_0x2bdc('0x15'))](_0x1eef70,_0x296b97,_0x32f271,_0x2e4340);}function storeTaskHashes(_0x20d710,_0x361159,_0xc00469){const _0x319e04=JSON['stringify'](_0x20d710[a1_0x2bdc('0x1a')](_0x5f1fcb=>({'taskId':_0x5f1fcb['taskId'],'hash':_0x5f1fcb['hash']})));if(environment_1[a1_0x2bdc('0x0')]){output[a1_0x2bdc('0xc')]({'title':a1_0x2bdc('0xa')+_0x319e04});}(0x0,fs_1['writeFileSync'])(path['join'](_0x361159,a1_0x2bdc('0x1c')+_0xc00469),_0x319e04);}function onComplete(_0x47a790,_0x11f6b7,_0x4fd319,_0x2f26c5,_0x6b7253,_0x439919,_0x362337,_0x3f4c3c,_0x4d606e,_0x189538,_0x9e91c8){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1c7431=new Date()[a1_0x2bdc('0x1b')]();if(environment_1[a1_0x2bdc('0x2d')]){storeTaskHashes(_0x4d606e,_0x11f6b7[a1_0x2bdc('0xe')]||'./node_modules/.cache/nx',environment_1[a1_0x2bdc('0x4')]);}const _0x2af036=(0x0,environment_1[a1_0x2bdc('0x2e')])();const _0x460728=yield Promise[a1_0x2bdc('0x33')]([_0x4fd319[a1_0x2bdc('0x2b')](),_0x2f26c5[a1_0x2bdc('0x9')]({'command':_0x6b7253[a1_0x2bdc('0x2c')]((0x0,environment_1[a1_0x2bdc('0x34')])()),'startTime':_0x439919,'endTime':_0x1c7431,'distributedExecutionId':environment_1[a1_0x2bdc('0x4')],'branch':_0x2af036,'scan':!![],'runGroup':(0x0,environment_1[a1_0x2bdc('0xd')])(),'sha':_0x2af036?(0x0,environment_1['extractGitSha'])():undefined,'inner':_0x9e91c8},_0x4d606e)]);if(_0x189538){setTimeout(()=>{_0x362337[a1_0x2bdc('0xf')]();if(!_0x362337[a1_0x2bdc('0x30')]&&!_0x9e91c8){_0x3f4c3c[a1_0x2bdc('0x13')]();}},0x0);}else{_0x362337[a1_0x2bdc('0xf')]();if(!_0x362337['anyErrors']&&!_0x9e91c8){_0x3f4c3c[a1_0x2bdc('0x13')]();}}if(environment_1[a1_0x2bdc('0x2d')]){if(!_0x460728[0x0]){output[a1_0x2bdc('0x16')]({'title':'Agent\x20wasn\x27t\x20able\x20to\x20store\x20artifacts'});_0x362337[a1_0x2bdc('0xf')]();process['exit'](environment_1[a1_0x2bdc('0x39')]);}if(!_0x460728[0x1]){output[a1_0x2bdc('0x16')]({'title':a1_0x2bdc('0x12')});_0x362337[a1_0x2bdc('0xf')]();process[a1_0x2bdc('0x19')](environment_1[a1_0x2bdc('0x39')]);}}yield(0x0,metric_logger_1['submitRunMetrics'])(_0x11f6b7);});}function createLifeCycle(_0x58f728,_0x278af1,_0x3a73aa,_0x5a5fd7){const _0x351e4f=new cloud_enabled_life_cycle_1['CloudEnabledLifeCycle'](_0x58f728,_0x278af1[a1_0x2bdc('0xe')],!!_0x278af1[a1_0x2bdc('0x2a')],_0x278af1['scan']===undefined?!![]:_0x278af1['scan'],_0x278af1[a1_0x2bdc('0x28')]||[],_0x3a73aa,_0x5a5fd7);try{const {CompositeLifeCycle}=require(a1_0x2bdc('0x32'));if(!CompositeLifeCycle)return _0x351e4f;return new CompositeLifeCycle([_0x278af1[a1_0x2bdc('0x14')],_0x351e4f]);}catch(_0x23c42f){return _0x351e4f;}}function cloudEnabledTasksRunner(_0xd7d6e2,_0x1cff59,_0x1d614c,_0x22cfc3=![]){const _0x31be7a={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0xd7d6e2};const _0x1822fd=_0x1cff59['lifeCycle']===undefined;const _0x4e699a=[];const _0x20f22c=new message_reporter_1[(a1_0x2bdc('0x5'))](_0x1cff59);const _0x1a82a6=createApi(_0x20f22c,_0x1cff59,_0x31be7a);const _0x9fbe35=new end_of_run_message_1[(a1_0x2bdc('0x27'))](_0x31be7a,_0x4e699a);const _0x262c43=new output_obfuscator_1[(a1_0x2bdc('0x25'))](_0x1cff59['maskedProperties']);const _0x260f71=_0xd7d6e2[a1_0x2bdc('0x1a')](_0x2272b5=>_0x2272b5['hash'])[a1_0x2bdc('0x37')](_0x19a3b6=>!!_0x19a3b6);const _0x82a0a9=_0x1a82a6[a1_0x2bdc('0x10')](environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'],_0x260f71);_0x260f71['forEach'](_0x4c0a84=>{_0x31be7a[a1_0x2bdc('0x26')][_0x4c0a84]=_0x82a0a9;});const _0x43e156=new Date()[a1_0x2bdc('0x1b')]();const _0x530591=createLifeCycle(_0x31be7a,_0x1cff59,_0x262c43,_0x4e699a);const _0x2d5e0c=new e2e_encryption_1['E2EEncryption'](environment_1[a1_0x2bdc('0x6')]||_0x1cff59[a1_0x2bdc('0x3')]);const _0x38529f=new error_reporter_api_1['ErrorReporterApi'](_0x1cff59);const _0x20e320=new file_storage_1[(a1_0x2bdc('0x21'))](_0x2d5e0c,_0x38529f,![]);const _0x3cc530=new cloud_remote_cache_1[(a1_0x2bdc('0x31'))](_0x20f22c,_0x1a82a6,_0x31be7a,_0x20e320);delete process[a1_0x2bdc('0x17')]['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'];const _0x20c08=tasksRunner(_0xd7d6e2,Object[a1_0x2bdc('0x20')](Object[a1_0x2bdc('0x20')]({},_0x1cff59),{'remoteCache':_0x3cc530,'lifeCycle':_0x530591}),_0x1d614c);if(_0x20c08[a1_0x2bdc('0x8')]){const {Subject}=require('rxjs/internal/Subject');const _0x1e1217=new Subject();_0x20c08[a1_0x2bdc('0x8')]({'next':_0x28ed6d=>_0x1e1217['next'](_0x28ed6d),'error':_0x5a7e14=>_0x1e1217[a1_0x2bdc('0x16')](_0x5a7e14),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0x530591,_0x1cff59,_0x3cc530,_0x1a82a6,_0x262c43,_0x43e156,_0x20f22c,_0x9fbe35,_0x4e699a,_0x1822fd,_0x22cfc3);_0x1e1217[a1_0x2bdc('0x29')]();})});return _0x1e1217;}else{return _0x20c08['then'](_0x5386e3=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0x530591,_0x1cff59,_0x3cc530,_0x1a82a6,_0x262c43,_0x43e156,_0x20f22c,_0x9fbe35,_0x4e699a,_0x1822fd,_0x22cfc3);return _0x5386e3;}))[a1_0x2bdc('0x36')](_0x2014c6=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0x530591,_0x1cff59,_0x3cc530,_0x1a82a6,_0x262c43,_0x43e156,_0x20f22c,_0x9fbe35,_0x4e699a,_0x1822fd,_0x22cfc3);throw _0x2014c6;}));}}exports[a1_0x2bdc('0x2f')]=cloudEnabledTasksRunner;